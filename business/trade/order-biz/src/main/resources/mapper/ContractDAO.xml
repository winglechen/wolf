<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="study.daydayup.wolf.business.trade.order.biz.dal.dao.ContractDAO">


<!--auto generated by MybatisCodeHelper on 2019-12-27-->
    <update id="updateByKey">
        update contract
        <set>
            <if test="updated.source != null and updated.source != ''">
                source = #{updated.source,jdbcType=VARCHAR},
            </if>
            <if test="updated.tags != null and updated.tags != ''">
                tags = #{updated.tags,jdbcType=VARCHAR},
            </if>

            <if test="updated.state != null">
                state = #{updated.state,jdbcType=TINYINT},
            </if>
            <if test="updated.relatedTradeNo != null and updated.relatedTradeNo != ''">
                related_trade_no = #{updated.relatedTradeNo,jdbcType=VARCHAR},
            </if>
            <if test="updated.expiredAt != null">
                expired_at = #{updated.expiredAt,jdbcType=TIMESTAMP},
            </if>
            version = version + 1,
            <if test="updated.deleteFlag != null">
                delete_flag = #{updated.deleteFlag,jdbcType=TINYINT},
            </if>
            <if test="updated.lastEditor != null">
                last_editor = #{updated.lastEditor,jdbcType=BIGINT},
            </if>
            <if test="updated.updatedAt != null">
                updated_at = #{updated.updatedAt,jdbcType=TIMESTAMP},
            </if>
        </set>
        where trade_no=#{key.tradeNo,jdbcType=VARCHAR}
        <if test="key.state != null" >
            and state = #{key.state,jdbcType=TINYINT}
        </if>
        <if test="key.buyerId != null">
            and buyer_id = #{key.buyerId,jdbcType=BIGINT}
        </if>
        <if test="key.sellerId != null ">
            and seller_id = #{key.sellerId,jdbcType=BIGINT}
        </if>
        <if test="key.version != null" >
            and version = #{key.version,jdbcType=INTEGER}
        </if>
        limit 1
    </update>

<!--auto generated by MybatisCodeHelper on 2019-12-27-->
    <select id="selectByTradeNo" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from contract
        where trade_no=#{tradeNo,jdbcType=VARCHAR}
        <if test="buyerId != null">
            and buyer_id = #{buyerId,jdbcType=BIGINT}
        </if>
        <if test="sellerId != null ">
            and seller_id = #{sellerId,jdbcType=BIGINT}
        </if>
        limit 1
    </select>

<!--auto generated by MybatisCodeHelper on 2020-01-17-->
    <select id="selectLatestByBuyer" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from contract
        where buyer_id=#{buyerId,jdbcType=BIGINT}
        <if test="sellerId != null ">
            and seller_id = #{sellerId,jdbcType=BIGINT}
        </if>
        order by id desc
        limit 1
    </select>

<!--auto generated by MybatisCodeHelper on 2020-01-17-->
    <select id="selectByBuyerId" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from contract
        where buyer_id=#{buyerId,jdbcType=BIGINT}
        ORDER BY id desc
    </select>

<!--auto generated by MybatisCodeHelper on 2020-01-17-->
    <select id="selectBySellerId" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from contract
        where seller_id=#{sellerId,jdbcType=BIGINT}
        ORDER BY id desc
    </select>

<!--auto generated by MybatisCodeHelper on 2020-01-18-->
    <select id="sellerByTradeType" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from contract
        where seller_id=#{query.sellerId,jdbcType=BIGINT}
        and trade_type=#{query.tradeType,jdbcType=TINYINT}
        <if test="query.state != null">
            and state = #{query.state,jdbcType=TINYINT}
        </if>
        <if test="query.createdAfter != null">
            <![CDATA[ and created_at > #{query.createdAfter,jdbcType=TIMESTAMP} ]]>
        </if>
        <if test="query.createdBefore != null">
            <![CDATA[ and created_at <= #{query.createdBefore,jdbcType=TIMESTAMP} ]]>
        </if>
        ORDER BY id desc
    </select>

    <!--auto generated by MybatisCodeHelper on 2020-01-18-->
    <select id="sellerByState" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from contract
        where seller_id=#{query.sellerId,jdbcType=BIGINT}
        and state = #{query.state,jdbcType=TINYINT}
        <if test="query.createdAfter != null">
            <![CDATA[ and created_at > #{query.createdAfter,jdbcType=TIMESTAMP} ]]>
        </if>
        <if test="query.createdBefore != null">
            <![CDATA[ and created_at <= #{query.createdBefore,jdbcType=TIMESTAMP} ]]>
        </if>
        ORDER BY id desc
    </select>

    <!--auto generated by MybatisCodeHelper on 2020-01-18-->
    <select id="sellerByStateIn" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from contract
        where seller_id=#{query.sellerId,jdbcType=BIGINT}
        and state in
        <foreach item="item" index="index" collection="query.stateSet"
                 open="(" separator="," close=")">
            #{item,jdbcType=VARCHAR}
        </foreach>
        <if test="query.createdAfter != null">
            <![CDATA[ and created_at > #{query.createdAfter,jdbcType=TIMESTAMP} ]]>
        </if>
        <if test="query.createdBefore != null">
            <![CDATA[ and created_at <= #{query.createdBefore,jdbcType=TIMESTAMP} ]]>
        </if>
        ORDER BY id desc
    </select>

    <!--auto generated by MybatisCodeHelper on 2020-01-18-->
    <select id="sellerByBuyerId" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from contract
        where seller_id=#{query.sellerId,jdbcType=BIGINT}
        and buyer_id=#{query.buyerId,jdbcType=BIGINT}
        <if test="query.tradeType != null">
            and trade_type = #{query.tradeType,jdbcType=TINYINT}
        </if>
        <if test="query.state != null">
            and state = #{query.state,jdbcType=TINYINT}
        </if>
        <if test="query.createdAfter != null">
            <![CDATA[ and created_at > #{query.createdAfter,jdbcType=TIMESTAMP} ]]>
        </if>
        <if test="query.createdBefore != null">
            <![CDATA[ and created_at <= #{query.createdBefore,jdbcType=TIMESTAMP} ]]>
        </if>
        ORDER BY id desc
    </select>

<!--auto generated by MybatisCodeHelper on 2020-01-20-->
    <select id="selectByTradeNoIn" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from contract
        where trade_no in
        <foreach item="item" index="index" collection="tradeNoCollection"
                 open="(" separator="," close=")">
            #{item,jdbcType=VARCHAR}
        </foreach>
        <if test="buyerId != null">
            and buyer_id = #{buyerId,jdbcType=BIGINT}
        </if>
        <if test="sellerId != null ">
            and seller_id = #{sellerId,jdbcType=BIGINT}
        </if>
        ORDER BY id desc
    </select>


</mapper>